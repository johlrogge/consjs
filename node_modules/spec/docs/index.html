<!DOCTYPE html>

<html>
<head>
  <title>spec.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>spec.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/*!
 * Spec unit testing library
 * http://github.com/kitcambridge/spec
 *
 * Copyright 2011-2013, Kit Cambridge
 * http://kitcambridge.github.com
 *
 * Released under the MIT License.
*/</span>

;(<span class="function"><span class="keyword">function</span> <span class="params">(root, Spec)</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">typeof</span> define == <span class="string">"function"</span> &amp;&amp; define.amd) {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Export Spec for asynchronous module loaders.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    define(<span class="string">"spec"</span>, [<span class="string">"exports"</span>], Spec);
  } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Export for CommonJS environments, web browsers, and JavaScript engines.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Spec = Spec(<span class="keyword">typeof</span> exports == <span class="string">"object"</span> &amp;&amp; exports || (root.Spec = {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><strong>noConflict</strong> restores the original value of the <code>Spec</code> variable and
returns a reference to the Spec object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="string">"noConflict"</span>: (<span class="function"><span class="keyword">function</span> <span class="params">(original)</span> {</span>
        <span class="function"><span class="keyword">function</span> <span class="title">noConflict</span><span class="params">()</span> {</span>
          root.Spec = original;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p><code>noConflict</code> can&#39;t be invoked more than once.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">delete</span> Spec.noConflict;
          <span class="keyword">return</span> Spec;
        }
        <span class="keyword">return</span> noConflict;
      })(root.Spec)
    }));
  }
})(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> <span class="params">(exports)</span> {</span>
  <span class="string">"use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>The current version of Spec. Keep in sync with <code>package.json</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports.version = <span class="string">"1.0.0"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2>Utility Methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><code>Object#toString</code> exposes the internal <code>[[Class]]</code> name of an object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> getClass = {}.toString, call = getClass.call,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>Spec.Environment</strong> stores information about the current environment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Environment = exports.Environment = {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Indicates whether the <code>Object#hasOwnProperty</code> function is supported.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">"hasOwnProp"</span>: <span class="literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Indicates whether the <code>[[Prototype]]</code> chain is exposed via the
<code>__proto__</code> property and can be mutated.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">"mutableProto"</span>: <span class="literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Indicates whether the JScript <code>[[DontEnum]]</code> bug is present.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">"dontEnum"</span>: <span class="literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Indicates whether the Safari 2 shadowed property enumeration bug is
present.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">"shadowEnum"</span>: <span class="literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Indicates whether <code>undefined</code> elements in arrays are treated as elisions
(JScript 5.x spec, section 2.1.26).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">"undefinedElisions"</span>: !(<span class="number">0</span> <span class="keyword">in</span> [<span class="keyword">void</span> <span class="number">0</span>]),</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Indicates whether Node&#39;s <code>process.nextTick</code> function is supported.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">"nextTick"</span>: <span class="keyword">typeof</span> process == <span class="string">"object"</span> &amp;&amp; process != <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> process.nextTick == <span class="string">"function"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Indicates whether the <code>setTimeout</code> function is supported.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">"setTimeout"</span>: <span class="keyword">typeof</span> setTimeout != <span class="string">"undefined"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Indicates whether Mozilla&#39;s LiveConnect APIs are supported.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">"java"</span>: <span class="keyword">typeof</span> java != <span class="string">"undefined"</span> &amp;&amp; java != <span class="literal">null</span> &amp;&amp; getClass.call(java) == <span class="string">"[object JavaPackage]"</span> &amp;&amp; <span class="keyword">typeof</span> JavaAdapter == <span class="string">"function"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Indicates whether <code>JavaAdapter</code>s work with abstract base classes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">"javaAdapter"</span>: <span class="literal">false</span>
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong>hasKey</strong> determines if a property is a direct property of the
specified object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  hasKey = exports.hasKey = (<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> memo = {}, hasOwnProperty = memo.hasOwnProperty, hasKey;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>The <code>__proto__</code> property can&#39;t be set more than once in Gecko.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Environment.mutableProto = (memo.__proto__ = <span class="literal">null</span>, memo.__proto__ = { <span class="number">1</span>: <span class="number">2</span> }, memo)[<span class="number">1</span>] == <span class="number">2</span>;
    memo = <span class="literal">null</span>;

    <span class="keyword">if</span> ((Environment.hasOwnProp = getClass.call(hasOwnProperty) == <span class="string">"[object Function]"</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Wrap <code>Object#hasOwnProperty</code> in conforming implementations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      hasKey = <span class="function"><span class="keyword">function</span> <span class="title">hasKey</span><span class="params">(object, property)</span> {</span>
        <span class="keyword">if</span> (object !== Object(object)) {
          <span class="keyword">throw</span> TypeError(<span class="string">"Invalid argument."</span>);
        }
        <span class="keyword">return</span> call.call(hasOwnProperty, object, property);
      };
    } <span class="keyword">else</span> <span class="keyword">if</span> (Environment.mutableProto) {</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Simulate <code>Object#hasOwnProperty</code> in Safari 2.0.3 and earlier.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      hasKey = <span class="function"><span class="keyword">function</span> <span class="title">hasKey</span><span class="params">(object, property)</span> {</span>
        <span class="keyword">var</span> original, result;
        <span class="keyword">if</span> (object !== Object(object)) {
          <span class="keyword">throw</span> TypeError(<span class="string">"Invalid argument."</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Capture and break the object&#39;s prototype chain. See the ES 5.1 spec,
section 8.6.2.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        original = object.__proto__;
        result = property <span class="keyword">in</span> (object.__proto__ = <span class="literal">null</span>, object);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Restore the original prototype chain.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        object.__proto__ = original;
        <span class="keyword">return</span> result;
      };
    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Use the <code>constructor</code> property to simulate <code>Object#hasOwnProperty</code> in
environments that don&#39;t expose the prototype chain.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      hasKey = <span class="function"><span class="keyword">function</span> <span class="title">hasKey</span><span class="params">(object, property)</span> {</span>
        <span class="keyword">if</span> (object !== Object(object)) {
          <span class="keyword">throw</span> TypeError(<span class="string">"Invalid argument."</span>);
        }
        <span class="keyword">var</span> parent = (object.constructor || Object).prototype;
        <span class="keyword">return</span> property <span class="keyword">in</span> object &amp;&amp; !(property <span class="keyword">in</span> parent &amp;&amp; object[property] === parent[property]);
      };
    }
    <span class="keyword">return</span> hasKey;
  })(),</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><strong>forOwn</strong> iterates over an <code>object</code>, executing a <code>callback</code> function once
per object member. If a <code>context</code> is specified, the <code>callback</code> is bound to
it. The iteration algorithm is normalized to account for cross-environment
inconsistencies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  forOwn = exports.forOwn = (<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> members, property, forOwn, size = <span class="number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Tests for bugs in the current environment&#39;s <code>for...in</code> algorithm. The
<code>valueOf</code> property inherits the non-enumerable flag from
<code>Object.prototype</code> in JScript &lt;= 5.8 and Gecko &lt;= 1.0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">function</span> <span class="title">Properties</span><span class="params">()</span> {</span>
      <span class="keyword">this</span>.valueOf = <span class="number">0</span>;
    }
    Properties.prototype.valueOf = <span class="number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Iterate over a new instance of the <code>Properties</code> class.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    members = <span class="keyword">new</span> Properties();
    <span class="keyword">for</span> (property <span class="keyword">in</span> members) {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Ignore all other properties inherited from <code>Object.prototype</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (hasKey(members, property)) {
        size += <span class="number">1</span>;
      }
    }
    members = <span class="literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Normalize the iteration algorithm.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (!size) {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>A list of non-enumerable properties inherited from <code>Object.prototype</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      members = [<span class="string">"valueOf"</span>, <span class="string">"toString"</span>, <span class="string">"toLocaleString"</span>, <span class="string">"propertyIsEnumerable"</span>, <span class="string">"isPrototypeOf"</span>, <span class="string">"hasOwnProperty"</span>, <span class="string">"constructor"</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>IE &lt;= 8, Mozilla 1.0, and Netscape 6.2 ignore shadowed non-enumerable
properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Environment.dontEnum = <span class="literal">true</span>;
      forOwn = <span class="function"><span class="keyword">function</span> <span class="title">forOwn</span><span class="params">(object, callback, context)</span> {</span>
        <span class="keyword">var</span> isFunction, property, length;
        <span class="keyword">if</span> (object !== Object(object)) {
          <span class="keyword">throw</span> TypeError(<span class="string">"Invalid argument."</span>);
        }
        isFunction = getClass.call(object) == <span class="string">"[object Function]"</span>;
        <span class="keyword">for</span> (property <span class="keyword">in</span> object) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Gecko &lt;= 1.0 enumerates the <code>prototype</code> property of functions under
certain conditions; IE does not.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">if</span> (!(isFunction &amp;&amp; property == <span class="string">"prototype"</span>) &amp;&amp; hasKey(object, property) &amp;&amp; call.call(callback, context, property, object[property], object) === <span class="literal">false</span>) {
            <span class="keyword">return</span>;
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Manually invoke the callback for each non-enumerable property.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">for</span> (length = members.length; length--;) {
          property = members[length];
          <span class="keyword">if</span> (hasKey(object, property) &amp;&amp; call.call(callback, context, property, object[property], object) === <span class="literal">false</span>) {
            <span class="keyword">break</span>;
          }
        }
      };
    } <span class="keyword">else</span> <span class="keyword">if</span> (size == <span class="number">2</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Safari &lt;= 2.0.4 enumerates shadowed properties twice.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Environment.shadowEnum = <span class="literal">true</span>;
      forOwn = <span class="function"><span class="keyword">function</span> <span class="title">forOwn</span><span class="params">(object, callback, context)</span> {</span>
        <span class="keyword">var</span> members, isFunction, property;
        <span class="keyword">if</span> (object !== Object(object)) {
          <span class="keyword">throw</span> TypeError(<span class="string">"Invalid argument."</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Create a set of iterated properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        members = {};
        isFunction = getClass.call(object) == <span class="string">"[object Function]"</span>;
        <span class="keyword">for</span> (property <span class="keyword">in</span> object) {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Store each property name to prevent double enumeration. The
<code>prototype</code> property of functions is not enumerated due to cross-
environment inconsistencies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">if</span> (!(isFunction &amp;&amp; property == <span class="string">"prototype"</span>) &amp;&amp; !hasKey(members, property) &amp;&amp; (members[property] = <span class="number">1</span>) &amp;&amp; hasKey(object, property) &amp;&amp; call.call(callback, context, property, object[property], object) === <span class="literal">false</span>) {
            <span class="keyword">break</span>;
          }
        }
      };
    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>No bugs detected; use the standard <code>for...in</code> algorithm.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      forOwn = <span class="function"><span class="keyword">function</span> <span class="title">forOwn</span><span class="params">(object, callback, context)</span> {</span>
        <span class="keyword">var</span> isFunction, property, isConstructor;
        <span class="keyword">if</span> (object !== Object(object)) {
          <span class="keyword">throw</span> TypeError(<span class="string">"Invalid argument."</span>);
        }
        isFunction = getClass.call(object) == <span class="string">"[object Function]"</span>;
        <span class="keyword">for</span> (property <span class="keyword">in</span> object) {
          <span class="keyword">if</span> (!(isFunction &amp;&amp; property == <span class="string">"prototype"</span>) &amp;&amp; hasKey(object, property) &amp;&amp; !(isConstructor = property === <span class="string">"constructor"</span>) &amp;&amp; call.call(callback, context, property, object[property], object) === <span class="literal">false</span>) {
            <span class="keyword">return</span>;
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Manually invoke the callback for the <code>constructor</code> property due to
cross-environment inconsistencies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (isConstructor || hasKey(object, <span class="string">"constructor"</span>)) {
          call.call(callback, context, <span class="string">"constructor"</span>, object.constructor, object);
        }
      };
    }
    <span class="keyword">return</span> forOwn;
  })(),</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><strong>equals</strong> recursively compares two objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  equals = exports.equals = (<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Comparison algorithm derived from work by Jeremy Ashkenas and Philippe
Rathe.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">function</span> <span class="title">eq</span><span class="params">(left, right, stack)</span> {</span>
      <span class="keyword">var</span> className, size, result;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Identical objects are equivalent.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (left === right) {</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p><code>0</code> and <code>-0</code> are identical, but they aren&#39;t equivalent. See the
ECMAScript Harmony <code>egal</code> proposal.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">return</span> left != <span class="number">0</span> || (<span class="number">1</span> / left == <span class="number">1</span> / right);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p><code>null</code> and <code>undefined</code> are compared by identity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (left == <span class="literal">null</span>) {
        <span class="keyword">return</span> left === right;
      }
      className = getClass.call(left);
      <span class="keyword">if</span> (className != getClass.call(right)) {
        <span class="keyword">return</span> <span class="literal">false</span>;
      }
      <span class="keyword">switch</span> (className) {</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Strings, numbers, dates, and booleans are compared by value.
Primitives and their corresponding object wrappers are equivalent;
thus, <code>&quot;5&quot;</code> is equivalent to <code>new String(&quot;5&quot;)</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">case</span> <span class="string">"[object String]"</span>:
          <span class="keyword">return</span> String(left) == String(right);
        <span class="keyword">case</span> <span class="string">"[object Number]"</span>:
          left = +left;
          right = +right;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p><code>NaN</code>s are equivalent, but non-reflexive. An <code>egal</code> comparison is
performed for other numeric values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">return</span> left != left ? right != right : (left ? left == right : (<span class="number">1</span> / left == <span class="number">1</span> / right));</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Coerce dates and booleans to numeric primitive values. Dates are
compared by their millisecond representations; invalid dates are not
equivalent.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">case</span> <span class="string">"[object Date]"</span>:
        <span class="keyword">case</span> <span class="string">"[object Boolean]"</span>:
          <span class="keyword">return</span> +left == +right;</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>RegExps are compared by their source patterns, flags, and
last-matched index.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">case</span> <span class="string">"[object RegExp]"</span>:
          <span class="keyword">return</span> left.source == right.source &amp;&amp;
                 left.global == right.global &amp;&amp;
                 left.multiline == right.multiline &amp;&amp;
                 left.ignoreCase == right.ignoreCase &amp;&amp;
                 left.lastIndex == right.lastIndex;
      }
      <span class="keyword">if</span> (<span class="keyword">typeof</span> left != <span class="string">"object"</span> || <span class="keyword">typeof</span> right != <span class="string">"object"</span>) {
        <span class="keyword">return</span> <span class="literal">false</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Assume equality for cyclic structures. The algorithm for detecting
cyclic structures is adapted from ES 5.1 section 15.12.3, abstract
operation <code>JO</code>. This is a linear search; performance is inversely
proportional to the number of unique nested objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">for</span> (size = stack.length; size--;) {
        <span class="keyword">if</span> (stack[size] == left) {
          <span class="keyword">return</span> <span class="literal">true</span>;
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Add the first object to the stack of traversed objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      stack.push(left);
      result = <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Recursively compare objects and arrays.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (className == <span class="string">"[object Array]"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Compare array lengths to determine if a deep comparison is necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        size = left.length;
        result = size == right.length;
        <span class="keyword">if</span> (result) {</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Deep compare the contents, ignoring non-numeric properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">while</span> (size--) {</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Ensure commutative equality for sparse arrays.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (!(result = (size <span class="keyword">in</span> left == size <span class="keyword">in</span> right) &amp;&amp; eq(left[size], right[size], stack))) {
              <span class="keyword">break</span>;
            }
          }
        }
      } <span class="keyword">else</span> {
        size = <span class="number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Deep compare objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        result = <span class="literal">true</span>;
        forOwn(left, <span class="function"><span class="keyword">function</span> <span class="params">(key, value)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Count the expected number of properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          size += <span class="number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Deep compare each own object member.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">return</span> result = hasKey(right, key) &amp;&amp; eq(value, right[key], stack);
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Ensure that both objects contain the same number of properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (result) {
          forOwn(right, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
            <span class="keyword">if</span> (!(size--)) {
              <span class="keyword">return</span> <span class="literal">false</span>;
            }
          });
          result = !size;
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Remove the first object from the stack of traversed objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      stack.pop();
      <span class="keyword">return</span> result;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Define the top-level <code>equals</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">function</span> <span class="title">equals</span><span class="params">()</span> {</span>
      <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">0</span>, length = arguments.length; index &lt; length - <span class="number">1</span>;) {</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Apply the comparison function left-to-right until all the provided
arguments have been consumed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (!eq(arguments[index], arguments[index += <span class="number">1</span>], [])) {
          <span class="keyword">return</span> <span class="literal">false</span>;
        }
      }
      <span class="keyword">return</span> <span class="literal">true</span>;
    }

    <span class="keyword">return</span> equals;
  })(),</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p><strong>forEach</strong> iterates over a <code>list</code> of elements, yielding to a <code>callback</code>
function on each iteration. If the <code>callback</code> explicitly returns <code>false</code>,
the loop will terminate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  forEach = exports.forEach = <span class="function"><span class="keyword">function</span> <span class="title">forEach</span><span class="params">(list, callback, context)</span> {</span>
    <span class="keyword">var</span> index, length;
    <span class="keyword">if</span> (Object(list) !== list) {
      <span class="keyword">throw</span> TypeError(<span class="string">"Invalid argument."</span>);
    }
    <span class="keyword">for</span> (index = <span class="number">0</span>, length = list.length &gt;&gt;&gt; <span class="number">0</span>; index &lt; length; index += <span class="number">1</span>) {
      <span class="keyword">if</span> (call.call(callback, context, list[index], index, list) === <span class="literal">false</span>) {
        <span class="keyword">break</span>;
      }
    }
    <span class="keyword">return</span> list;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p><strong>defer</strong> attempts to execute a callback function asynchronously in supported
environments.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  defer = exports.defer = (<span class="keyword">function</span>() {
    <span class="keyword">var</span> defer, timer;</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p><code>process.nextTick</code> executes a function asynchronously in Node.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (Environment.nextTick) {
      defer = <span class="function"><span class="keyword">function</span> <span class="title">defer</span><span class="params">(callback, context)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p><code>process.nextTick</code> is an efficient alternative to <code>setTimeout(..., 0)</code>.
As of Node 0.6.9, neither <code>process.nextTick</code> nor <code>setTimeout</code> isolate
execution; if the <code>callback</code> throws an exception, subsequent deferred
callbacks <strong>will not execute</strong>. This is an unfortunate incompatibility
with both the <code>setTimeout</code> function exposed in Browsers and Phantom,
and the Java <code>Timer</code> API exposed via LiveConnect in Rhino.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span> {</span>
          call.call(callback, context);
        }
        process.nextTick(run);
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Browsers and Phantom provide the <code>setTimeout</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    } <span class="keyword">else</span> <span class="keyword">if</span> (Environment.setTimeout) {
      defer = <span class="function"><span class="keyword">function</span> <span class="title">defer</span><span class="params">(callback, context)</span> {</span>
        <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span> {</span>
          call.call(callback, context);
        }
        setTimeout(run, <span class="number">0</span>);
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Mozilla Rhino&#39;s LiveConnect interface exposes the Java <code>Timer</code> API for
executing tasks in a background thread.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    } <span class="keyword">else</span> <span class="keyword">if</span> (Environment.java) {
      defer = <span class="function"><span class="keyword">function</span> <span class="title">defer</span><span class="params">(callback, context)</span> {</span>
        timer = <span class="keyword">new</span> java.util.Timer();
        <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Terminate the background thread once the task runs. If the thread
is not terminated, the Rhino process will persist even after
execution is completed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          timer.cancel();
          call.call(callback, context);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Schedule the timer task for background execution. A new scheduler is
created for each task to ensure that exceptions do not leak between
tasks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        timer.schedule(<span class="keyword">new</span> JavaAdapter(java.util.TimerTask, { <span class="string">"run"</span>: run }), <span class="number">0</span>);
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Rhino 1.74R has a bug that prevents <code>JavaAdapter</code> to work with abstract
base classes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">try</span> {
        defer(<span class="keyword">function</span>() {});
        Environment.javaAdapter = <span class="literal">true</span>;
      } <span class="keyword">catch</span>(exception) {
        timer.cancel();
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Execute the callback function synchronously in other environments.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (!defer || !Environment.javaAdapter) {
      defer = <span class="function"><span class="keyword">function</span> <span class="title">defer</span><span class="params">(callback, context)</span> {</span>
        call.call(callback, context);
      };
    }
    <span class="keyword">return</span> defer;
  }());</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <h2>Custom Events</h2>

            </div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p><code>Spec.Events</code> provides an interface for managing custom events. You can
add and remove individual event handlers; triggering an event executes its
handlers in succession. Based on work by Jeremy Ashkenas.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports.Events = Events;
  <span class="function"><span class="keyword">function</span> <span class="title">Events</span><span class="params">()</span> {</span>
    <span class="keyword">this</span>.events = {};
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p><strong>addListener</strong> attaches a <code>callback</code> function to an <code>event</code>. The callback
will be invoked whenever the event, specified by a string identifier, is
fired. If the <code>event</code> contains spaces, it is treated as a list of multiple
event types. If the optional <code>context</code> argument is provided, the <code>callback</code>
will be bound to it. Callbacks attached to the special <code>all</code> event will be
invoked for <strong>all</strong> triggered events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Events.prototype.on = Events.prototype.addListener = addListener;
  <span class="function"><span class="keyword">function</span> <span class="title">addListener</span><span class="params">(event, callback, context)</span> {</span>
    <span class="keyword">if</span> (event &amp;&amp; callback) {
      forEach(event.split(<span class="string">" "</span>), <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> {</span>
        <span class="keyword">var</span> callbacks = hasKey(<span class="keyword">this</span>.events, event) &amp;&amp; <span class="keyword">this</span>.events[event], target = callbacks ? callbacks.previous : {}, previous;
        target.next = previous = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Store the event handler and context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        target.callback = callback;
        target.context = context;</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Create a new event target node.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.events[event] = {
          <span class="string">"previous"</span>: previous,
          <span class="string">"next"</span>: callbacks ? callbacks.next : target
        };
      }, <span class="keyword">this</span>);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p><strong>removeListener</strong> removes a previously-bound event handler. If the
<code>context</code> is omitted, all versions of the handler, including those bound to
different contexts, will be removed. If the <code>callback</code> is omitted, all
registered handlers for the given <code>event</code> will be removed. If both the
<code>callback</code> and <code>event</code> are omitted, <strong>all</strong> listeners for all events will
be removed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Events.prototype.removeListener = removeListener;
  <span class="function"><span class="keyword">function</span> <span class="title">removeListener</span><span class="params">(event, callback, context)</span> {</span>
    <span class="keyword">if</span> (!event) {</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Remove all event listeners.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.events = {};
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.events) {
      forEach(event.split(<span class="string">" "</span>), <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> {</span>
        <span class="keyword">var</span> target = hasKey(<span class="keyword">this</span>.events, event) &amp;&amp; <span class="keyword">this</span>.events[event], previous;
        <span class="keyword">if</span> (target) {</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Remove the event listener registry.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">delete</span> <span class="keyword">this</span>.events[event];
          <span class="keyword">if</span> (callback) {</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Create a new registry without the given listener.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            previous = hasKey(target, <span class="string">"previous"</span>) &amp;&amp; target.previous;
            <span class="keyword">for</span> (; (target = hasKey(target, <span class="string">"next"</span>) &amp;&amp; target.next) != previous;) {
              <span class="keyword">if</span> (hasKey(target, <span class="string">"callback"</span>) &amp;&amp; target.callback != callback || (context &amp;&amp; (hasKey(target, <span class="string">"context"</span>) &amp;&amp; target.context != context))) {
                <span class="keyword">this</span>.on(event, target.callback, target.context);
              }
            }
          }
        }
      }, <span class="keyword">this</span>);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p><strong>emit</strong> fires an event, specified by either a string identifier or an
event object with a <code>type</code> property. Multiple event types are not
supported for string identifiers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Events.prototype.emit = emit;
  <span class="function"><span class="keyword">function</span> <span class="title">emit</span><span class="params">(event)</span> {</span>
    <span class="keyword">var</span> target, type, previous, all, error;</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Convert a string identifier into an event object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (<span class="keyword">typeof</span> event == <span class="string">"string"</span> || getClass.call(event) == <span class="string">"[object String]"</span>) {
      event = { <span class="string">"type"</span>: event };
    }
    type = hasKey(event, <span class="string">"type"</span>) &amp;&amp; event.type;</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Capture a reference to the current event target.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (!hasKey(event, <span class="string">"target"</span>)) {
      event.target = <span class="keyword">this</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Capture a reference to the callback registry for the <code>all</code> event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    all = type != <span class="string">"all"</span> &amp;&amp; hasKey(<span class="keyword">this</span>.events, <span class="string">"all"</span>) &amp;&amp; <span class="keyword">this</span>.events.all;
    <span class="keyword">if</span> ((target = hasKey(<span class="keyword">this</span>.events, type) &amp;&amp; <span class="keyword">this</span>.events[type])) {
      previous = hasKey(target, <span class="string">"previous"</span>) &amp;&amp; target.previous;
      <span class="keyword">for</span> (; (target = hasKey(target, <span class="string">"next"</span>) &amp;&amp; target.next) != previous;) {</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Execute the callbacks in succession.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">try</span> {
          call.call(target.callback, hasKey(target, <span class="string">"context"</span>) &amp;&amp; target.context || <span class="keyword">this</span>, event);
        } <span class="keyword">catch</span> (exception) {
          error = exception;</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Re-throw exceptions asynchronously, allowing all subsequent
callbacks to fire.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          defer(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
            <span class="keyword">throw</span> error;
          });
        }
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Fire the <code>all</code> event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (all) {
      previous = hasKey(all, <span class="string">"previous"</span>) &amp;&amp; all.previous;
      <span class="keyword">for</span> (; (all = hasKey(all, <span class="string">"next"</span>) &amp;&amp; all.next) != previous;) {
        <span class="keyword">try</span> {
          call.call(all.callback, hasKey(all, <span class="string">"context"</span>) &amp;&amp; all.context || <span class="keyword">this</span>, event);
        } <span class="keyword">catch</span> (exception) {
          error = exception;
          defer(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
            <span class="keyword">throw</span> error;
          });
        }
      }
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <h2>Suites</h2>

            </div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Suites are event-driven collections of unit tests. Using custom events, you
can create routines for setting up and tearing down tests, handling
assertions and failures, and logging test results.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports.Suite = Suite;</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Creates a new suite with an optional <code>name</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">Suite</span><span class="params">(name)</span> {</span>
    Events.call(<span class="keyword">this</span>);
    <span class="keyword">if</span> (name != <span class="literal">null</span>) {
      <span class="keyword">this</span>.name = name;
    }
    <span class="keyword">this</span>.length = <span class="number">0</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>The default suite name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Suite.prototype.name = <span class="string">"Anonymous Suite"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Add support for custom events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Suite.prototype = <span class="keyword">new</span> Events();
  Suite.prototype.constructor = Suite;</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Extend the <code>Suite</code> prototype with generic array methods.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  (<span class="function"><span class="keyword">function</span> <span class="params">(prototype, methods)</span> {</span>
    <span class="keyword">for</span> (<span class="keyword">var</span> index = -<span class="number">1</span>, method; method = methods[index += <span class="number">1</span>];) {
      prototype[method] = methods[method];
    }
  })(Suite.prototype, [<span class="string">"join"</span>, <span class="string">"pop"</span>, <span class="string">"push"</span>, <span class="string">"reverse"</span>, <span class="string">"shift"</span>, <span class="string">"sort"</span>, <span class="string">"splice"</span>, <span class="string">"unshift"</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Shuffles the suite using a Fisher-Yates shuffle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Suite.prototype.shuffle = shuffle;
  <span class="function"><span class="keyword">function</span> <span class="title">shuffle</span><span class="params">()</span> {</span>
    <span class="keyword">for</span> (<span class="keyword">var</span> value, index, length = <span class="keyword">this</span>.length &gt;&gt;&gt; <span class="number">0</span>; length;) {
      index = Math.floor(Math.random() * length);
      value = <span class="keyword">this</span>[--length];
      <span class="keyword">this</span>[length] = <span class="keyword">this</span>[index];
      <span class="keyword">this</span>[index] = value;
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Adds a test to the suite. The test name is optional.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Suite.prototype.addTest = addTest;
  <span class="function"><span class="keyword">function</span> <span class="title">addTest</span><span class="params">(name, test)</span> {</span>
    <span class="keyword">this</span>.push(<span class="keyword">new</span> Test(name, test));
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Returns the index of the next available test relative to the given
<code>position</code>, or <code>null</code> if no additional tests are available.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Suite.prototype.index = index;
  <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">(position)</span> {</span>
    <span class="keyword">var</span> length = <span class="keyword">this</span>.length &gt;&gt;&gt; <span class="number">0</span>, test;
    position || (position = <span class="number">0</span>);
    <span class="keyword">if</span> (position &lt; <span class="number">0</span>) {
      position = length + position;
    }
    <span class="keyword">for</span> (; position &lt; length; position += <span class="number">1</span>) {
      test = position <span class="keyword">in</span> <span class="keyword">this</span> &amp;&amp; <span class="keyword">this</span>[position];
      <span class="keyword">if</span> (test &amp;&amp; <span class="keyword">typeof</span> test.constructor == <span class="string">"function"</span> &amp;&amp; test <span class="keyword">instanceof</span> Test) {
        <span class="keyword">return</span> position;
      }
    }
    <span class="keyword">return</span> <span class="literal">null</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>An event handler invoked each time a test in the suite emits an event.
This event handler updates the suite summary and prepares to run the next
test.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Suite.prototype.onEvent = onSuiteEvent;
  <span class="function"><span class="keyword">function</span> <span class="title">onSuiteEvent</span><span class="params">(event)</span> {</span>
    <span class="keyword">var</span> target = event.target;</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Proxy the fired event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.emit(event);
    <span class="keyword">switch</span> (event.type) {</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Update the suite summary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">case</span> <span class="string">"assertion"</span>:
        <span class="keyword">this</span>.assertions += <span class="number">1</span>;
        <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">"failure"</span>:
        <span class="keyword">this</span>.failures += <span class="number">1</span>;
        <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">"teardown"</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Unbind the internal event handler.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        target.removeListener(<span class="string">"all"</span>, <span class="keyword">this</span>.onEvent, <span class="keyword">this</span>);
        <span class="keyword">if</span> ((<span class="keyword">this</span>.position = <span class="keyword">this</span>.index(<span class="keyword">this</span>.position += <span class="number">1</span>)) != <span class="literal">null</span>) {
          target = <span class="keyword">this</span>[<span class="keyword">this</span>.position];</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Run the next test.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          defer(target.on(<span class="string">"all"</span>, <span class="keyword">this</span>.onEvent, <span class="keyword">this</span>).run, target);
        } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Finish running the suite.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">this</span>.emit(<span class="string">"complete"</span>);
        }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Runs the suite.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Suite.prototype.run = runSuite;
  <span class="function"><span class="keyword">function</span> <span class="title">runSuite</span><span class="params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Create the spec summary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> target;
    <span class="keyword">this</span>.position = <span class="keyword">this</span>.assertions = <span class="keyword">this</span>.failures = <span class="number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Begin running the suite.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.emit(<span class="string">"start"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Bind the internal event handler to the first test.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> ((<span class="keyword">this</span>.position = <span class="keyword">this</span>.index(<span class="keyword">this</span>.position)) != <span class="literal">null</span>) {
      target = <span class="keyword">this</span>[<span class="keyword">this</span>.position];</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Run the first test.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      defer(target.on(<span class="string">"all"</span>, <span class="keyword">this</span>.onEvent, <span class="keyword">this</span>).run, target);
    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Finish running the suite.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.emit(<span class="string">"complete"</span>);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <h2>Tests</h2>

            </div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Wraps a test function with convenience methods and assertions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports.Test = Test;
  <span class="function"><span class="keyword">function</span> <span class="title">Test</span><span class="params">(name, test)</span> {</span>
    Events.call(<span class="keyword">this</span>);
    <span class="keyword">if</span> (name &amp;&amp; test == <span class="literal">null</span>) {
      test = name;
      name = <span class="literal">null</span>;
    }
    <span class="keyword">if</span> (name != <span class="literal">null</span>) {
      <span class="keyword">this</span>.name = name;
    }
    <span class="keyword">this</span>.test = test;</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Bind the helper event handler.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.on(<span class="string">"all"</span>, <span class="keyword">this</span>.onEvent, <span class="keyword">this</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Add support for custom events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype = <span class="keyword">new</span> Events();
  Test.prototype.constructor = Test;</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>The default test name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.name = <span class="string">"Anonymous Test"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>An event handler invoked each time a test emits an event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.onEvent = onTestEvent;
  <span class="function"><span class="keyword">function</span> <span class="title">onTestEvent</span><span class="params">(event)</span> {</span>
    <span class="keyword">var</span> expected;
    <span class="keyword">switch</span> (event.type) {
      <span class="keyword">case</span> <span class="string">"setup"</span>:
        <span class="keyword">this</span>.assertions = <span class="keyword">this</span>.failures = <span class="number">0</span>;
        <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">"assertion"</span>:
        <span class="keyword">this</span>.assertions += <span class="number">1</span>;
        <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">"failure"</span>:
        <span class="keyword">this</span>.failures += <span class="number">1</span>;
        <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">"teardown"</span>:
        expected = event.expected;</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Verify that the expected number of assertions were executed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> ((<span class="keyword">typeof</span> expected == <span class="string">"number"</span> || getClass.call(expected) == <span class="string">"[object Number]"</span>) &amp;&amp; expected != <span class="keyword">this</span>.assertions) {
          <span class="keyword">this</span>.emit({
            <span class="string">"type"</span>: <span class="string">"failure"</span>,
            <span class="string">"actual"</span>: <span class="keyword">this</span>.assertions,
            <span class="string">"expected"</span>: expected,
            <span class="string">"message"</span>: <span class="string">"done"</span>
          });
        }
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p><strong>assert</strong> creates a new assertion method with the given <code>name</code>. If the
provided <code>callback</code> function returns a falsy value, the assertion fails.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.assert = assert;
  <span class="function"><span class="keyword">function</span> <span class="title">assert</span><span class="params">(name, callback)</span> {</span>
    <span class="function"><span class="keyword">function</span> <span class="title">assertion</span><span class="params">(actual, expected, message)</span> {</span>
      <span class="keyword">return</span> <span class="keyword">this</span>.ok(call.call(callback, <span class="keyword">this</span>, actual, expected), {
        <span class="string">"actual"</span>: actual,
        <span class="string">"expected"</span>: expected,
        <span class="string">"message"</span>: message == <span class="literal">null</span> ? name : message
      });
    }
    <span class="keyword">return</span> assertion;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Runs the test.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.run = runTest;
  <span class="function"><span class="keyword">function</span> <span class="title">runTest</span><span class="params">()</span> {</span>
    <span class="keyword">this</span>.emit(<span class="string">"setup"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Pass the wrapper as the first argument to the test function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.test(<span class="keyword">this</span>);
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p><strong>ok</strong> tests whether an <code>expression</code> is truthy. The optional <code>message</code>
defaults to the name of the current assertion (e.g., <code>ok</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.ok = ok;
  <span class="function"><span class="keyword">function</span> <span class="title">ok</span><span class="params">(expression, event)</span> {</span>
    <span class="keyword">if</span> (Object(event) !== event) {
      event = {
        <span class="string">"actual"</span>: expression,
        <span class="string">"expected"</span>: <span class="literal">true</span>,
        <span class="string">"message"</span>: event == <span class="literal">null</span> ? <span class="string">"ok"</span> : event
      };
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Note: To test for the boolean <code>true</code>, use the <code>strictEqual</code> assertion.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    event.type = expression ? <span class="string">"assertion"</span> : <span class="string">"failure"</span>;
    <span class="keyword">return</span> <span class="keyword">this</span>.emit(event);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p><strong>notOk</strong> tests whether an <code>expression</code> is falsy.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.notOk = notOk;
  <span class="function"><span class="keyword">function</span> <span class="title">notOk</span><span class="params">(expression, message)</span> {</span>
    <span class="keyword">return</span> <span class="keyword">this</span>.ok(!expression, message == <span class="literal">null</span> ? <span class="string">"notOk"</span> : message);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p><strong>equal</strong> tests whether <code>actual</code> is <strong>equal</strong> to <code>expected</code>, as determined
by the <code>==</code> operator.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.equal = assert(<span class="string">"equal"</span>, assertEqual);
  <span class="function"><span class="keyword">function</span> <span class="title">assertEqual</span><span class="params">(actual, expected)</span> {</span>
    <span class="keyword">return</span> actual == expected;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p><strong>notEqual</strong> tests for <strong>loose</strong> or coercive inequality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.notEqual = assert(<span class="string">"notEqual"</span>, assertNotEqual);
  <span class="function"><span class="keyword">function</span> <span class="title">assertNotEqual</span><span class="params">(actual, expected)</span> {</span>
    <span class="keyword">return</span> actual != expected;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p><strong>strictEqual</strong> tests for <strong>strict</strong> equality (<code>actual === expected</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.strictEqual = assert(<span class="string">"strictEqual"</span>, assertStrictEqual);
  <span class="function"><span class="keyword">function</span> <span class="title">assertStrictEqual</span><span class="params">(actual, expected)</span> {</span>
    <span class="keyword">return</span> actual === expected;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p><strong>notStrictEqual</strong> tests for strict inequality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.notStrictEqual = assert(<span class="string">"notStrictEqual"</span>, assertStrictNotEqual);
  <span class="function"><span class="keyword">function</span> <span class="title">assertStrictNotEqual</span><span class="params">(actual, expected)</span> {</span>
    <span class="keyword">return</span> actual !== expected;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p><strong>deepEqual</strong> tests for deep equality and equivalence, as determined by the
<code>Spec.equals</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.deepEqual = assert(<span class="string">"deepEqual"</span>, equals);</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p><strong>notDeepEqual</strong> tests for deep inequality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.notDeepEqual = assert(<span class="string">"notDeepEqual"</span>, assertNotDeepEqual);
  <span class="function"><span class="keyword">function</span> <span class="title">assertNotDeepEqual</span><span class="params">(actual, expected)</span> {</span>
    <span class="keyword">return</span> !equals(actual, expected);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Ensures that the <code>callback</code> function throws an exception.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.error = assertError;
  <span class="function"><span class="keyword">function</span> <span class="title">assertError</span><span class="params">(callback, expected, message)</span> {</span>
    <span class="keyword">var</span> ok = <span class="literal">false</span>, isFunction = <span class="keyword">typeof</span> expected == <span class="string">"function"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Invalid expected value; the message was passed as the second argument.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (!isFunction &amp;&amp; message == <span class="literal">null</span>) {
      message = expected;
      expected = <span class="literal">null</span>;
    }
    <span class="keyword">try</span> {
      callback();
    } <span class="keyword">catch</span> (exception) {
      ok = expected == <span class="literal">null</span> || (isFunction &amp;&amp; call.call(expected, <span class="keyword">this</span>, exception, <span class="keyword">this</span>));
    }
    <span class="keyword">return</span> <span class="keyword">this</span>.ok(ok, message == <span class="literal">null</span> ? <span class="string">"error"</span> : message);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Ensures that the <code>callback</code> function does not throw any exceptions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.noError = assertNoError;
  <span class="function"><span class="keyword">function</span> <span class="title">assertNoError</span><span class="params">(callback, message)</span> {</span>
    <span class="keyword">var</span> ok = <span class="literal">true</span>;
    <span class="keyword">try</span> {
      callback();
    } <span class="keyword">catch</span> (exception) {
      ok = <span class="literal">false</span>;
    }
    <span class="keyword">return</span> <span class="keyword">this</span>.ok(ok, message == <span class="literal">null</span> ? <span class="string">"noError"</span> : message);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p><strong>done</strong> completes a test with an optional number of expected <code>assertions</code>.
This method <strong>must</strong> be called at the end of each test.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Test.prototype.done = done;
  <span class="function"><span class="keyword">function</span> <span class="title">done</span><span class="params">(assertions)</span> {</span>
    <span class="keyword">return</span> <span class="keyword">this</span>.emit({
      <span class="string">"type"</span>: <span class="string">"teardown"</span>,
      <span class="string">"expected"</span>: assertions
    });
  };
  <span class="keyword">return</span> exports;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
